
# HG changeset patch
# User welpy-cw <h.w.forms@arcor.de>
# Date 1764283677 0
# Node ID 375f48c3f90973a1f57125827546400d131d2c5e
# Parent  07d5c4391e556f4ebae8cb15f8b7346a8114589d
Bug 1742234 - Have 'Find in Settings" retrieve matching subcategories. r=freaktechnik

Differential Revision: https://phabricator.services.mozilla.com/D271907

diff --git a/mail/components/preferences/findInPage.js b/mail/components/preferences/findInPage.js
--- a/mail/components/preferences/findInPage.js
+++ b/mail/components/preferences/findInPage.js
@@ -266,32 +266,52 @@ var gSearchResultsPane = {
         if (child.hidden) {
           child.classList.add("visually-hidden");
           child.hidden = false;
         }
       }
 
       let ts = performance.now();
       const FRAME_THRESHOLD = 10;
+      let underFoundSubcategory = false;
 
       // Showing or Hiding specific section depending on if words in query are found.
       for (const child of rootPreferencesChildren) {
         if (performance.now() - ts > FRAME_THRESHOLD) {
           // Creating tooltips for all the instances found.
           for (const anchorNode of this.listSearchTooltips) {
             this.createSearchTooltip(anchorNode, this.query);
           }
           ts = await new Promise(resolve =>
             window.requestAnimationFrame(resolve)
           );
           if (query !== this.query) {
             return;
           }
         }
 
+        if (underFoundSubcategory) {
+          if (!child.classList.contains("subcategory")) {
+            await this.searchWithinNode(child, this.query);
+            child.classList.remove("visually-hidden");
+            continue;
+          }
+          underFoundSubcategory = false;
+        }
+
+        if (
+          child.classList.contains("subcategory") &&
+          (await this.searchWithinNode(child, this.query))
+        ) {
+          child.classList.remove("visually-hidden");
+          underFoundSubcategory = true;
+          resultsFound = true;
+          continue;
+        }
+
         if (
           !child.classList.contains("header") &&
           !child.classList.contains("subcategory") &&
           (await this.searchWithinNode(child, this.query))
         ) {
           child.classList.remove("visually-hidden");
 
           // Show the preceding search-header if one exists.

