
# HG changeset patch
# User Magnus Melin <mkmelin+mozilla@iki.fi>
# Date 1763458509 -7200
# Node ID 3fe1f53a722d5124e58d97e49c3ee02d0eba5888
# Parent  7df814cdbd2e7767cfd0933cdda4721f086eb11b
Bug 1978213 - encode filenames for browser.messages.openAttachment. r=john.bieling

Differential Revision: https://phabricator.services.mozilla.com/D272838

diff --git a/mail/components/extensions/parent/ext-messages.js b/mail/components/extensions/parent/ext-messages.js
--- a/mail/components/extensions/parent/ext-messages.js
+++ b/mail/components/extensions/parent/ext-messages.js
@@ -991,17 +991,17 @@ this.messages = class extends ExtensionA
 
           const isExternalAttachment = attachmentPart.headers.has(
             "x-mozilla-external-attachment-url"
           );
           const data = {
             contentType: attachmentPart.headers.contentType.type,
             url:
               getMsgPartUrl(msgHdr, partName) +
-              `&filename=${attachmentPart.name}`,
+              `&filename=${encodeURIComponent(attachmentPart.name)}`,
             name: attachmentPart.name,
             uri: msgHdr.folder
               ? msgHdr.folder.getUriForMsg(msgHdr)
               : msgHdr.getStringProperty("dummyMsgUrl"),
             isExternalAttachment,
             message: msgHdr,
           };
           const attachmentInfo = new AttachmentInfo(data);

