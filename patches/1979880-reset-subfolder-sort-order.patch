
# HG changeset patch
# User welpy-cw <h.w.forms@arcor.de>
# Date 1762971832 25200
# Node ID ecc2ac50c64533078f4cf54e153ad701248cce73
# Parent  c78534fe8f919302eef66bb281131bdb75f8c197
Bug 1979880 - Fix 'Reset Folder Order' for subfolders. r=tobyp,mkmelin

Differential Revision: https://phabricator.services.mozilla.com/D271966

diff --git a/mail/base/content/about3Pane.js b/mail/base/content/about3Pane.js
--- a/mail/base/content/about3Pane.js
+++ b/mail/base/content/about3Pane.js
@@ -4229,34 +4229,38 @@ var folderPane = {
 
   /**
    * Clear any previously applied custom sort order to all the child folders of
    * a parent.
    *
    * @param {nsIMsgFolder} parentFolder
    */
   clearUserSortOrder(parentFolder) {
-    const folders = [];
-    for (const folder of this._getSubFolders(parentFolder)) {
-      if (folder.userSortOrder == Ci.nsIMsgFolder.NO_SORT_VALUE) {
-        continue;
+    const clearRecursively = parent => {
+      const folders = [];
+      for (const folder of this._getSubFolders(parent)) {
+        if (folder.hasSubFolders) {
+          clearRecursively(folder);
+        }
+
+        if (folder.userSortOrder == Ci.nsIMsgFolder.NO_SORT_VALUE) {
+          continue;
+        }
+
+        folder.userSortOrder = Ci.nsIMsgFolder.NO_SORT_VALUE;
+        folders.push(folder);
       }
 
-      folder.userSortOrder = Ci.nsIMsgFolder.NO_SORT_VALUE;
-      folders.push(folder);
-
-      if (folder.hasSubFolders) {
-        this.clearUserSortOrder(folder);
+      for (const changedFolder of folders) {
+        this.setOrderToRowInAllModes(changedFolder, changedFolder.sortOrder);
+        this.refreshFolderPaneUI(changedFolder);
       }
-    }
-
-    for (const changedFolder of folders) {
-      this.setOrderToRowInAllModes(changedFolder, changedFolder.sortOrder);
-      this.refreshFolderPaneUI(changedFolder);
-    }
+    };
+
+    clearRecursively(parentFolder);
 
     window.dispatchEvent(
       new CustomEvent("folder-sort-order-restored", { bubbles: true })
     );
   },
 
   /**
    * Set folder sort order to rows for the folder.

