
# HG changeset patch
# User Richard Marti <richard.marti@gmail.com>
# Date 1761988185 0
# Node ID 91d7c38c051b0a2d7c12ed9ecf471ed77c9e8744
# Parent  a9a3a95940aa8cb7727527df2a7d437267e82bf9
Bug 1898889 - Fix the crypto-button on message header with long subjects. r=jmiksic,vineet

Differential Revision: https://phabricator.services.mozilla.com/D270946

diff --git a/mail/base/content/msgHdrView.inc.xhtml b/mail/base/content/msgHdrView.inc.xhtml
--- a/mail/base/content/msgHdrView.inc.xhtml
+++ b/mail/base/content/msgHdrView.inc.xhtml
@@ -405,35 +405,39 @@
   <!-- Subject + security info + extra date label for hidden To variation -->
   <html:div id="headerSubjectSecurityContainer" class="message-header-row">
      <html:div id="expandedsubjectRow" class="header-row-grow">
       <label id="expandedsubjectLabel" class="message-header-label"
              value="&subjectField4.label;"/>
       <html:div id="expandedsubjectBox" is="simple-header-row"
                 data-header-name="subject"></html:div>
     </html:div>
-    <html:div id="cryptoBox" hidden="hidden">
-      <html:button id="encryptionTechBtn"
-                   class="toolbarbutton-1 crypto-button themeable-brighttext button-focusable"
-                   data-l10n-id="message-security-button">
-        <html:span class="crypto-label"></html:span>
-        <html:img id="encryptedHdrIcon" hidden="hidden" alt="" />
-        <html:img id="signedHdrIcon" hidden="hidden" alt="" />
-      </html:button>
-    </html:div>
-    <html:time id="dateLabelSubject"
-               class="message-header-datetime"
-               aria-readonly="true"
-               hidden="hidden"></html:time>
-    <html:div id="darkReaderToggle" xmlns="http://www.w3.org/1999/xhtml">
-      <label for="disableDarkReader" class="toggle-label">
-        <input id="disableDarkReader"
-               type="checkbox"
-               class="toggle-checkbox toggle-checkbox-sm dark-reader-toggle" />
-      </label>
+    <html:div id="expandedButtonsBox">
+      <html:time id="dateLabelSubject"
+                 class="message-header-datetime"
+                 aria-readonly="true"
+                 hidden="hidden"></html:time>
+      <html:div id="buttonsBox">
+        <html:div id="cryptoBox" hidden="hidden">
+          <html:button id="encryptionTechBtn"
+                       class="toolbarbutton-1 crypto-button themeable-brighttext button-focusable"
+                       data-l10n-id="message-security-button">
+            <html:span class="crypto-label"></html:span>
+            <html:img id="encryptedHdrIcon" hidden="hidden" alt="" />
+            <html:img id="signedHdrIcon" hidden="hidden" alt="" />
+          </html:button>
+        </html:div>
+        <html:div id="darkReaderToggle" xmlns="http://www.w3.org/1999/xhtml">
+          <label for="disableDarkReader" class="toggle-label">
+            <input id="disableDarkReader"
+                   type="checkbox"
+                   class="toggle-checkbox toggle-checkbox-sm dark-reader-toggle" />
+          </label>
+        </html:div>
+      </html:div>
     </html:div>
   </html:div>
 
   <!-- Tags -->
   <html:div id="expandedtagsRow" class="message-header-row" hidden="hidden">
     <label id="expandedtagsLabel" class="message-header-label"
            value="&tagsHdr4.label;"/>
     <html:div id="expandedtagsBox" is="header-tags-row"
diff --git a/mail/themes/shared/mail/messageHeader.css b/mail/themes/shared/mail/messageHeader.css
--- a/mail/themes/shared/mail/messageHeader.css
+++ b/mail/themes/shared/mail/messageHeader.css
@@ -267,16 +267,29 @@ mail-tagfield[collapsed] {
   padding-inline: var(--message-header-field-offset);
   /* IMPORTANT! Keep these to avoid issues with very long subjects. Bug 77806 */
   display: -webkit-box;
   -webkit-box-orient: vertical;
   -webkit-line-clamp: 3;
   overflow-y: auto;
 }
 
+#expandedButtonsBox {
+  align-self: normal;
+  display: flex;
+  flex-direction: column;
+  justify-content: space-between;
+}
+
+#buttonsBox {
+  display: flex;
+  align-items: end;
+  justify-content: flex-end;
+}
+
 /* ::::: attachment view ::::: */
 
 #attachmentBar {
   color: var(--layout-color-1);
   background-color: var(--layout-background-1);
   padding: 3px 0;
   overflow: hidden;
 }
@@ -527,16 +540,17 @@ button.email-action-button {
 }
 
 .crypto-label {
   font-weight: 600;
   white-space: nowrap;
 }
 
 .crypto-button {
+  min-width: initial;
   margin-block: 0;
   margin-inline-end: 3px;
   fill: currentColor;
   background-color: transparent;
   display: flex;
   flex-wrap: nowrap;
   align-items: center;
   flex-direction: row;

