
# HG changeset patch
# User Alessandro Castellani <alessandro@thunderbird.net>
# Date 1752272299 0
# Node ID 04c4af2ddadbedfb6c61e927f41de67687008b8f
# Parent  00381aef9a8684987a0986c7febef8432b49981b
Bug 1968915 - Register the UIDensity and UIFontSize after the AutoTreeView widget is initialized in the ABSearchDialog. r=tobyp

Differential Revision: https://phabricator.services.mozilla.com/D257077

diff --git a/mail/components/addrbook/content/abSearchDialog.js b/mail/components/addrbook/content/abSearchDialog.js
--- a/mail/components/addrbook/content/abSearchDialog.js
+++ b/mail/components/addrbook/content/abSearchDialog.js
@@ -55,19 +55,16 @@ var gSearchAbViewListener = {
       ).replace("#1", aTotal);
     }
 
     gStatusText.setAttribute("value", statusText);
   },
 };
 
 function searchOnLoad() {
-  UIDensity.registerWindow(window);
-  UIFontSize.registerWindow(window);
-
   initializeSearchWidgets();
   initializeSearchWindowWidgets();
 
   gSearchBundle = Services.strings.createBundle(
     "chrome://messenger/locale/search.properties"
   );
   gSearchStopButton.setAttribute(
     "label",
@@ -178,16 +175,20 @@ function searchOnLoad() {
   );
   gAbResultsTree.addEventListener("select", () =>
     gSearchAbViewListener.onSelectionChanged()
   );
   gAbResultsTree.addEventListener("viewchange", () =>
     gSearchAbViewListener.onCountChanged(gAbResultsTree.view?.rowCount)
   );
 
+  // Register these after the AutoTreeView widget has been properly initialized.
+  UIDensity.registerWindow(window);
+  UIFontSize.registerWindow(window);
+
   onMore(null);
 }
 
 function searchOnUnload() {
   CloseAbView();
 }
 
 function disableCommands() {
diff --git a/mail/components/addrbook/test/browser/browser_search_dialog.js b/mail/components/addrbook/test/browser/browser_search_dialog.js
--- a/mail/components/addrbook/test/browser/browser_search_dialog.js
+++ b/mail/components/addrbook/test/browser/browser_search_dialog.js
@@ -22,17 +22,17 @@ add_setup(async function () {
     "pop3"
   );
   MailServices.accounts.defaultAccount = account;
 
   for (const name of ["daniel", "jonathan", "nathan"]) {
     cards[name] = personalBook.addCard(createContact(name, "test"));
   }
 
-  // Add "WorkPhone"
+  // Add "WorkPhone".
   cards.daniel.vCardProperties.addEntry(
     new VCardPropertyEntry("tel", { type: "work" }, "text", "+1555987654321")
   );
   personalBook.modifyCard(cards.daniel);
   cards.nathan.vCardProperties.addEntry(
     new VCardPropertyEntry("tel", { type: "work" }, "text", "555-123-456")
   );
   personalBook.modifyCard(cards.nathan);

