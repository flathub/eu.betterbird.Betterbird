
# HG changeset patch
# User Magnus Melin <mkmelin+mozilla@iki.fi>
# Date 1762882455 -7200
# Node ID 0f00c8246bfcc970e8d9b64530313e04e8615959
# Parent  b78d9a38d88fda7761e5edd46d1f86337f469ff5
Bug 1978213 - Add filename to attachment url so that pdfs opened in the internal viewer via browser.messages.openAttachment have a name when downloaded. r=john.bieling

Differential Revision: https://phabricator.services.mozilla.com/D262896

diff --git a/mail/components/extensions/parent/ext-messages.js b/mail/components/extensions/parent/ext-messages.js
--- a/mail/components/extensions/parent/ext-messages.js
+++ b/mail/components/extensions/parent/ext-messages.js
@@ -985,17 +985,19 @@ this.messages = class extends ExtensionA
             );
           }
 
           const isExternalAttachment = attachmentPart.headers.has(
             "x-mozilla-external-attachment-url"
           );
           const data = {
             contentType: attachmentPart.headers.contentType.type,
-            url: getMsgPartUrl(msgHdr, partName),
+            url:
+              getMsgPartUrl(msgHdr, partName) +
+              `&filename=${attachmentPart.name}`,
             name: attachmentPart.name,
             uri: msgHdr.folder
               ? msgHdr.folder.getUriForMsg(msgHdr)
               : msgHdr.getStringProperty("dummyMsgUrl"),
             isExternalAttachment,
             message: msgHdr,
           };
           const attachmentInfo = new AttachmentInfo(data);

