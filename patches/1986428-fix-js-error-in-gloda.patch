
# HG changeset patch
# User Magnus Melin <mkmelin+mozilla@iki.fi>
# Date 1757051873 -10800
# Node ID e79f24482f961bb032a32c2b8113a8c6f16e5455
# Parent  4a69b4d1f71588bbf4af2c81dfedc406ee4c159a
Bug 1986428 - Fix JavaScript error: resource:///modules/gloda/MimeMessage.sys.mjs, line 136: TypeError: can't access property "spec", aRequest.URI is undefined. r=aleca

Differential Revision: https://phabricator.services.mozilla.com/D263367

diff --git a/mailnews/db/gloda/modules/MimeMessage.sys.mjs b/mailnews/db/gloda/modules/MimeMessage.sys.mjs
--- a/mailnews/db/gloda/modules/MimeMessage.sys.mjs
+++ b/mailnews/db/gloda/modules/MimeMessage.sys.mjs
@@ -125,20 +125,23 @@ CallbackStreamListener.prototype = {
     this._callbacks = null;
   },
 
   // nsIStreamListener part
 
   /**
    * Our onDataAvailable should actually never be called. The stream converter
    * is actually eating everything except the start and stop notification.
+   *
+   * @param {nsIRequest} request - Request corresponding to the source of the data.
    */
-  onDataAvailable(aRequest) {
+  onDataAvailable(request) {
+    const spec = request instanceof Ci.nsIChannel ? request.URI.spec : request;
     throw new Error(
-      `The stream converter should have grabbed the data for ${aRequest?.URI.spec}`
+      `The stream converter should have grabbed the data for ${spec}`
     );
   },
 };
 
 /**
  * @param {?MimeContainer} aPart - MIME part to handle.
  * @returns {?MimeContainer} the MIME part, with encrypted parts removed.
  */

